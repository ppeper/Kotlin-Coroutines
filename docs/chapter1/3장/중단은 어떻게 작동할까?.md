# 3ì¥ ì¤‘ë‹¨ì€ ì–´ë–»ê²Œ ì‘ë™í• ê¹Œ?

> ğŸ’¡ê¸°ë³¸ì ìœ¼ë¡œ ì½”ë£¨í‹´ì€ ì¤‘ë‹¨ì‹œ Continuation ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ì´ ê°ì²´ëŠ” ê²Œì„ì„ í•˜ë‹¤ ì €ì¥ì„ í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•˜ë‹¤ê³  ë³´ë©´ ëœë‹¤. ë”°ë¼ì„œ ê²Œì„ê³¼ ê°™ì´ Continuationì„ ì´ìš©í•˜ë©´ ë©ˆì·„ë˜ ê³³ì—ì„œ ë‹¤ì‹œ ì½”ë£¨í‹´ì„ ì‹¤í–‰ í•  ìˆ˜ ìˆë‹¤.

### ğŸ“ŒÂ suspendCoroutine

- Continuation ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ì•„ ì¤‘ë‹¨ì ì„ ì•Œ ìˆ˜ ìˆë„ë¡ í•œë‹¤.
- ì½”ë£¨í‹´ì„ ì¤‘ë‹¨ì‹œí‚¤ëŠ” í•¨ìˆ˜ë¡œ, ëŒë‹¤ë¥¼ ë„˜ê²¨ì£¼ë©´ ë¡œë£¨í‹´ì´ ì¤‘ë‹¨ë˜ê¸° ì´ì „ì— ì‹¤í–‰ëœë‹¤.
    - suspendCoroutineì´ í˜¸ì¶œëœ ë’¤ì—ëŠ” ì´ë¯¸ ì¤‘ë‹¨ë˜ì–´ Continuation ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, ëŒë‹¤ í‘œí˜„ì‹ì˜ ì¸ìë¡œ ë“¤ì–´ê°€ ì¤‘ë‹¨ë˜ê¸° ì´ì „ì— ì‹¤í–‰ë˜ëŠ” ê²ƒ.

```kotlin
suspend fun main() {
    println("Before")
    suspendCoroutine<Unit> { continuation ->
        println("Suspended")
        continuation.resume(Unit)
    }
    println("After")
}

// ì¶œë ¥ ê²°ê³¼:
// Before
// Suspended
// After
```

### ğŸ“ŒÂ Continuation

> ğŸ’¡Kotlin 1.3 ì´í›„ë¡œ Continutation í´ë˜ìŠ¤ì˜ í˜•íƒœê°€ ë‹¬ë¼ì¡Œë‹¤.
> 
> ê¸°ì¡´ì—ëŠ” resume, resumeWithExceptionì„ ì‚¬ìš©í–ˆì§€ë§Œ, í˜„ì¬ëŠ” Resultë¥¼ ë°˜í™˜í•˜ëŠ” resumeWith í•¨ìˆ˜ í•˜ë‚˜ë¡œ í™•ì¥ í•¨ìˆ˜ì˜ í˜•íƒœë¡œ ë³€ê²½ë˜ì—ˆë‹¤.

```kotlin
@SinceKotlin("1.3")
@InlineOnly
public inline fun <T> Continuation<T>.resume(value: T): Unit =
    resumeWith(Result.success(value))

/**
 * Resumes the execution of the corresponding coroutine so that the [exception] is re-thrown right after the
 * last suspension point.
 */
@SinceKotlin("1.3")
@InlineOnly
public inline fun <T> Continuation<T>.resumeWithException(exception: Throwable): Unit =
    resumeWith(Result.failure(exception))
```

- ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ì—¬  ì ì‹œ ì •ì§€(sleep) ì´í›„ ì½”ë£¨í‹´ì„ ë‹¤ì‹œ ì¬ê°œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì§€ë§Œ ê·¸ë ‡ê²Œ íš¨ìœ¨ ì ì´ì§€ ì•Šë‹¤.
    - JVMì—ì„œ ì œê³µí•˜ëŠ” ScheduledExecutorService ë¥¼ ì‚¬ìš©í•˜ì—¬ â€œì•ŒëŒ ì‹œê³„â€ ë¥¼ ë§Œë“¤ì–´ ì •í•´ì§„ ì‹œê°„ì´ ì§€ë‚˜ë©´ continuation.resume()ì„ í˜¸ì¶œí•˜ë„ë¡ ì•ŒëŒì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

```kotlin
private val executor =
    Executors.newSingleThreadScheduledExecutor {
        Thread(it, "scheduler").apply { isDaemon = true }
    }
    
suspend fun delay(timeMillis: Long) =
    suspendCoroutine { cont ->
        executor.schedule({
            cont.resume(Unit)
        }, timeMillis, TimeUnit.MILLISECONDS)
    }

suspend fun main() {
		println("Before")
		
		delay(1000L)
		
		println("After")
}
    
// Before
// (1ì´ˆ í›„)
// After
```

- ì—¬ê¸°ì„œ delay í•¨ìˆ˜ëŠ” ì½”í‹€ë¦° ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” delayì˜ êµ¬í˜„ ë°©ì‹ì´ë‘ ì •í™•íˆ ì¼ì¹˜í•œë‹¤. í˜„ì¬ delayì˜ êµ¬í˜„ì€ í…ŒìŠ¤íŠ¸ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ë§ì´ ë°”ë€Œì—ˆì§€ë§Œ í•µì‹¬ ë¡œì§ì€ ë™ì¼í•˜ë‹¤ê³  í•œë‹¤.

### ğŸ“ŒÂ ê°’ìœ¼ë¡œ ì¬ê°œí•˜ê¸°

- Continuationì˜ ì œë„¤ë¦­ íƒ€ì…ì˜ ì¸ìë¡œ resume í•¨ìˆ˜ë„ ë™ì¼í•˜ê²Œ ì§€ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤.
- APIë¥¼ í˜¸ì¶œí•´ ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì„ ê¸°ìë¦¬ëŠ” ê²ƒì²˜ëŸ¼ íŠ¹ì • ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ì¤‘ë‹¨í•˜ëŠ” ìƒí™©ì€ ìì£¼ ë°œìƒí•œë‹¤.
    - ì½”ë£¨í‹´ì´ ì—†ë‹¤ë©´ ìŠ¤ë ˆë“œëŠ” ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ê³  ìˆì„ ìˆ˜ ë°–ì— ì—†ë‹¤. (ìì› ë‚­ë¹„)
    - ì½”ë£¨í‹´ì´ ìˆìœ¼ë©´ â€œë°ì´í„°ë¥¼ ë°›ìœ¼ë©´, í•´ë‹¹ ê²°ê³¼ ê°’ì„ resume í•¨ìˆ˜ë¥¼ í†µí•´ ë³´ë‚´ì¤˜â€ ë¼ê³  Continuation ê°ì²´ë¥¼ í†µí•´ ì „ë‹¬ í•  ìˆ˜ ìˆê³ , ìŠ¤ë ˆë“œëŠ” ë‹¤ë¥¸ ì¼ì„ í•  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìƒê¸´ë‹¤.

```kotlin
// ì™¸ë¶€ì—ì„œ êµ¬í˜„ëœ requestUser ì½œë°± í•¨ìˆ˜ê°€ ìˆë‹¤ê³  í•˜ì
fun requestUser(callback: (User) -> Unit) {
    callback(User(name = "Text"))
}

suspend fun main() {
    println("Before")
    val user = suspendCoroutine { continuation ->
        requestUser { user ->
            continuation.resume(user)
        }
    }
    println(user)
    println("After")
} 
 
// suspendCoroutine ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šê³  ì¤‘ë‹¨ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì.
suspend fun requestUser(): User {
    return suspendCoroutine { continuation ->
        requestUser { user ->
            continuation.resume(user)
        }
    }
}
    
suspend fun main() {
    println("Before")
    val user = requestUser()
    println(user)
    println("After")
}  
```

### ğŸ“ŒÂ ì˜ˆì™¸ë¡œ ì¬ê°œí•˜ê¸°

- ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  í•¨ìˆ˜ë¥¼ ê°’ì„ ë°˜í™˜ ë˜ëŠ” ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤.
- resumeì´ í˜¸ì¶œë  ë•Œ suspendCoroutine ë˜í•œ ì¸ìë¡œ ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤. resumeWithExceptionì´ í˜¸ì¶œë˜ë©´ ì¤‘ë‹¨ëœ ì§€ì ì—ì„œ ì¸ìë¡œ ë„£ì–´ì¤€ ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤.
    - ì´ëŸ¬í•œ ë°©ë²•ì€ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì˜ˆì™¸ ë“±ì„ ì•Œë¦´ ë•Œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

```kotlin
class MyException: Throwable("Just an Exception")

suspend fun main() {
    try {
        suspendCoroutine<Unit> {  continuation ->
            continuation.resumeWithException(MyException())
        }
    } catch (e: MyException) {
        println("Caught!")
    }
}

// Caught!
```